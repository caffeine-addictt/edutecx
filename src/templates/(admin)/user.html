<!doctype html>
{% extends 'layout.html' %}


<!-- Title -->
{% block title %}
  User Dashboard - EduTecX
{% endblock %}


<!-- Body -->
{% block mainContent %}
  <div id="graph-container" class="mx-auto my-2 ratio-16x9 w-50 h-50">
    <img id="graph" src="" alt="Drawing..." width="100%" height="100%" />
  </div>


  <!-- Update graph URI -->
  <script>
    const fetchGraphURI = async () => {
      response = await fetch('/dashboard/graph', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: 'Bearer {{ session["access_token"] }}'
        },
        body: JSON.stringify({
          "graphFor": "User"
        })
      })

      data = await response.json()
      if (!response.ok) throw new Error(data.message)

      $('#graph').attr('src', data.data.uri)
      console.log('Fetched URI: ' + data.data.uri)

      return data.data.uri
    }

    $(document).ready(() => Promise.all([fetchGraphURI()])
      .then(values => console.log(values))
      .catch(err => console.log(err)))
    


  </script>
{% endblock %}
