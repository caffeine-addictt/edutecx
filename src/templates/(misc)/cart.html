<!doctype html>
{% extends 'layout.html' %}


{# Title #}
{% block title %}
  Cart - EduTecX
{% endblock %}


{# Body #}
{% block mainContent %}
  <div id="cart__container" class="d-flex flex-column gap-2 my-2 ratio-16x9 w-50 h-50">
    <div id="cart__items" class="d-flex flex-column gap-2">

    </div>

    <a href="/store">Store</a>

    <button type="button" class="btn btn-primary" onclick="clearCart(true);"> Clear Cart </button>
  </div>

  <script>
    $(document).ready(async () => {
      /** @type {string[]} */
      const items = getCartItems();
      
      
      /** @type {Promise<{
       *    status : 200;
       *    message: string;
       *    data: {
       *      id         : string;
       *      author_id  : string;
       *      title      : string;
       *      description: string;
       *      categories : string[];
       *      price      : number;
       *      discount   : number;
       *      uri        : string;
       *      status     : string;
       *      cover_image: string?;
       *      created_at : number;
       *      updated_at : number;
       *    };
       *  } | {
       *    status : 404;
       *    message: string;
       *  }
       *}>[]}
       */
      const queryPayloads = [];

      for (const itemID of items) {
        queryPayloads.push(
          fetch(`/api/v1/textbook/get?textbook_id=${itemID}`)
            .then(async res => await res.json()));
      }

      /** @type {Array.<{
       *    status : 200;
       *    message: string;
       *    data: {
       *      id         : string;
       *      author_id  : string;
       *      title      : string;
       *      description: string;
       *      categories : string[];
       *      price      : number;
       *      discount   : number;
       *      uri        : string;
       *      status     : string;
       *      cover_image: string?;
       *      created_at : number;
       *      updated_at : number;
       *    };
       *  } | {
       *    status : 404;
       *    message: string;
       *  }
       * }>}
       */
      const responses = await Promise.all(queryPayloads);

      
      // Populate HTML
      responses.forEach(res => {
        if (res.status === 200) {
          $('#cart__items').append(
            `<div> <a href="/store/${res.data.id}">${res.data.title}</a> </div>`
          );
        }
      });

    });
  </script>
{% endblock %}
